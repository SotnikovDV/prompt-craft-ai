# Руководство по административной панели

## Обзор

Административная панель предоставляет полный контроль над настройками ИИ-сервиса, статистикой и управлением запросами пользователей.

## Доступ

### Права администратора
- Доступ имеют только пользователи с email адресами, указанными в `config/app.php` в массиве `admin_emails`
- Текущие администраторы:
  - `sotnikovdv@yandex.ru`
  - `dvst.com@gmail.com`

### Вход в панель
1. Войдите в систему под учетной записью администратора
2. В выпадающем меню пользователя нажмите "⚙️ Админ панель"
3. Или перейдите напрямую по адресу: `http://localhost:81/admin/settings`

## Разделы панели

### 1. Настройки сервиса (`/admin/settings`)

#### Настройки ИИ
- **Дневной лимит для гостей** (1-100): Количество запросов в день для незарегистрированных пользователей
- **Дневной лимит для пользователей** (1-1000): Количество запросов в день для зарегистрированных пользователей (оставьте пустым для снятия лимита)
- **Максимальное количество токенов** (100-10000): Лимит токенов для ответа ИИ
- **Температура** (0-2): Креативность ответов ИИ (0 = детерминированно, 2 = очень креативно)
- **Дни хранения запросов гостей** (1-30): Через сколько дней удалять запросы незарегистрированных пользователей
- **Системный промпт**: Основная инструкция для ИИ при генерации промптов

#### Настройки LLM
- **API ключ Perplexity**: Ключ для доступа к API Perplexity
- **Базовый URL Perplexity**: URL для подключения к API

#### Настройки приложения
- **Название приложения**: Отображаемое название сервиса
- **Email адреса администраторов**: Список администраторов (можно добавлять/удалять)

### 2. Статистика (`/admin/statistics`)

#### Основные метрики
- **Всего запросов**: Общее количество обработанных запросов
- **Сегодня**: Количество запросов за текущий день
- **Среднее время**: Среднее время обработки запроса
- **Всего токенов**: Общее количество использованных токенов

#### Детальная аналитика
- **По типам пользователей**: Разделение на зарегистрированных пользователей и гостей
- **По периодам**: Статистика за день, неделю, месяц
- **Популярные области знаний**: Топ доменов по количеству запросов
- **График активности**: Визуализация активности за последние 30 дней

### 3. Управление запросами (`/admin/requests`)

#### Фильтрация
- **ID пользователя**: Поиск запросов конкретного пользователя
- **Область знаний**: Фильтр по доменам
- **Дата от/до**: Временной диапазон
- **Сброс фильтров**: Очистка всех фильтров

#### Просмотр запросов
- **Таблица запросов**: ID, пользователь, запрос, область, время, токены, действия
- **Пагинация**: Навигация по страницам (20 запросов на страницу)
- **Детали запроса**: Модальное окно с полной информацией о запросе

## Функции

### Обновление настроек
1. Измените нужные параметры в форме
2. Нажмите "Сохранить настройки"
3. Система автоматически:
   - Обновит конфигурационные файлы
   - Очистит кэш конфигурации
   - Покажет уведомление об успехе/ошибке

### Управление администраторами
1. В разделе "Настройки приложения"
2. Добавьте новый email: нажмите "Добавить администратора"
3. Удалите администратора: нажмите красный крестик рядом с email
4. Сохраните изменения

### Мониторинг системы
- **Статистика в реальном времени**: Обновляется при каждом заходе
- **Фильтрация запросов**: Быстрый поиск по различным критериям
- **Экспорт данных**: Возможность просмотра детальной информации

## Безопасность

### Middleware защиты
- Все административные маршруты защищены middleware `admin`
- Проверка аутентификации пользователя
- Проверка прав администратора по email

### Валидация данных
- Все настройки проходят валидацию перед сохранением
- Ограничения на значения параметров
- Проверка формата email адресов

## Техническая информация

### Файлы конфигурации
- `config/ai.php` - настройки ИИ
- `config/llm.php` - настройки языковых моделей
- `config/app.php` - общие настройки приложения

### База данных
- Таблица `prompt_requests` - все запросы пользователей
- Автоматическая очистка старых запросов гостей
- Индексы для быстрого поиска

### Логирование
- Все действия администратора логируются
- Ошибки обновления настроек записываются в лог
- Отслеживание изменений конфигурации

## Устранение неполадок

### Проблемы с доступом
1. Проверьте, что ваш email в списке администраторов
2. Убедитесь, что вы авторизованы в системе
3. Очистите кэш браузера

### Ошибки сохранения настроек
1. Проверьте права на запись в папку `config/`
2. Убедитесь в корректности значений
3. Проверьте логи Laravel для детальной информации

### Проблемы с отображением
1. Очистите кэш конфигурации: `php artisan config:clear`
2. Пересоберите ассеты: `npm run build`
3. Проверьте права на папку `storage/logs/`

## Контакты

При возникновении проблем обращайтесь к разработчику или создайте issue в репозитории проекта.
